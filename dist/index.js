"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react");function n(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,c(t.key),t)}}function r(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,u,o,c,i=[],a=!0,l=!1;try{if(o=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;a=!1}else for(;!(a=(t=o.call(r)).done)&&(i.push(t.value),i.length!==n);a=!0);}catch(e){l=!0,u=e}finally{try{if(!a&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(l)throw u}}return i}}(e,n)||u(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,n){if(e){if("string"==typeof e)return o(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,n):void 0}}function o(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function c(e){var n=function(e,n){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,n||"default");if("object"!=typeof t)return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:String(n)}var i=new(function(){function e(){var n,r,t;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n=this,t=[],(r=c(r="observers"))in n?Object.defineProperty(n,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[r]=t}var r,t,u;return r=e,(t=[{key:"subscribe",value:function(e){this.observers.push(e)}},{key:"unsubscribe",value:function(e){var n=this.observers.indexOf(e);-1!==n&&this.observers.splice(n,1)}},{key:"emit",value:function(){this.observers.forEach((function(e){return e()}))}}])&&n(r.prototype,t),u&&n(r,u),Object.defineProperty(r,"prototype",{writable:!1}),e}()),a="__REDUX_DEVTOOLS_EXTENSION__",l=function(e){return"[useMemoReducer] ".concat(e)},f=function(e){return"development"===process.env.NODE_ENV&&""!==e&&"undefined"!=typeof window&&(n=window,a in n&&n[a]);var n},s=new Map([]),v=function(e){var n=r(e.split("/"),2);return[n[0],n[1]-1]},b=function(e,n){var u,o=r(v(e),2),c=o[0],i=o[1],a=null!==(u=s.get(c))&&void 0!==u?u:[],b=a[i];if(b)return b;var d=function(e,n){return e?e.connect({name:l(n),trace:!0,instanceId:l(n)}):null}(f(e),e);return d?(s.set(c,[].concat(t(a),[d])),d.init(n),d):(console.warn("[useReduxDevtools] Connection ".concat(e," was not created.")),null)},d=function(e){!function(e){var n,t=r(v(e),2),u=t[0],o=t[1],c=null!==(n=s.get(u))&&void 0!==n?n:[];if(c[o]){var i=c.filter((function(e,n){return n!==o}));0===i.length?s.delete(u):s.set(u,i)}else console.warn("[useMemoReducer] Connection ".concat(e," is not exists"))}(e);var n=f(e);n&&(n.disconnect(),i.emit())},y=function(n,t,u,o){var c=e.useRef(n(t,{type:"@@INIT"})),a=e.useMemo((function(){return o?b(u,c.current):null}),[u,o]);if(!a)return{devtoolsEnabled:function(){return!1}};var l=e.useRef(),f=e.useCallback((function(){var e;return null===(e=l.current)||void 0===e||e.call(l),null==a?void 0:a.subscribe((function(e){}))}),[a]),y=e.useCallback((function(){null==a||a.send({type:"@@RECONNECT"},c.current),l.current=f()}),[a,f]);e.useEffect((function(){return i.subscribe(y),function(){i.unsubscribe(y)}}),[y]),e.useEffect((function(){return l.current=f(),function(){var e;null===(e=l.current)||void 0===e||e.call(l),d(u)}}),[u,f]);var p=e.useCallback((function(e){c.current=n(c.current,e),null==a||a.send(e,c.current)}),[a,n]),m=e.useCallback((function(){return function(e){var n,t=r(v(e),2),u=t[0],o=t[1];return void 0!==(null===(n=s.get(u))||void 0===n?void 0:n[o])}(u)}),[u]);return e.useMemo((function(){return{devtoolsEnabled:m,dispatchToDevtools:p}}),[m,p])},p=function(n,r,t){var u=e.useRef(r),o=e.useMemo((function(){return function(e){var n;if(null==e||!e.devtoolsName)return"";var r=e.devtoolsName.toLowerCase(),t=null!==(n=s.get(r))&&void 0!==n?n:[],u=t.length>0?t.length+1:1;return"".concat(r,"/").concat(u)}(t)}),[]);return y(n,u.current,o,function(e){return""!==e&&f(e)}(o))};exports.useMemoReducer=function(n,t,u){var o=p(n,t,u),c=r(e.useReducer(n,t),2),i=c[0],a=c[1],l=e.useRef(o);l.current=o;var f=e.useRef(i);f.current=i;var s=function(){return f.current},v=e.useCallback((function(e){if(function(e){return"function"==typeof e}(e))return e(v,s);var n,r;l.current.devtoolsEnabled()&&(null===(n=(r=l.current).dispatchToDevtools)||void 0===n||n.call(r,e));return a(e)}),[]),b=e.useRef(new Set([]));e.useLayoutEffect((function(){b.current.forEach((function(e){return e(i)}))}),[i]);var d=e.useCallback((function(e){b.current.add(e)}),[]),y=e.useCallback((function(e){b.current.delete(e)}),[]),m=e.useCallback((function(n){return function(n,t,u){var o=u.subscribe,c=u.unSubscribe,i=r(e.useState(0),2)[1],a=e.useRef(n);a.current=n;var l=e.useRef(n(t));l.current=n(t);var f=e.useCallback((function(e){a.current(e)!==l.current&&i((function(e){return e+1}))}),[]),s=e.useRef(!1),v=e.useCallback((function(){s.current=!1,c(f)}),[c,f]);return e.useEffect((function(){return s.current||o(f),s.current=!0,v}),[f,o]),l.current}(n,s(),{subscribe:d,unSubscribe:y})}),[d,y]);return e.useMemo((function(){return[m,v]}),[v,m])};
